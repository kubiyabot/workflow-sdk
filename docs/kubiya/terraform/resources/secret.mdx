---
title: "kubiya_secret"
sidebarTitle: "Secret Resource"
description: "Manage sensitive information securely like API keys, passwords, and tokens"
icon: "key"
---

The `kubiya_secret` resource allows you to create and manage secrets in the Kubiya platform. Secrets store sensitive information like API keys, passwords, and tokens that can be securely accessed by Kubiya agents during execution.

<Tip>
Secrets provide a secure way to handle sensitive data in your automation workflows. They are encrypted at rest and only accessible to authorized agents during execution.
</Tip>

## Prerequisites

Before using this resource, ensure you have:

1. A Kubiya account with API access
2. An API key (generated from Kubiya dashboard under Admin â†’ Kubiya API Keys)
3. Proper security practices for handling sensitive data in Terraform

## Quick Start

<CodeGroup>

```hcl Basic API Key
variable "external_api_key" {
  type        = string
  sensitive   = true
  description = "External service API key"
}

resource "kubiya_secret" "api_key" {
  name        = "external-api-key"
  value       = var.external_api_key
  description = "API key for external service"
}

resource "kubiya_agent" "api_agent" {
  name         = "api-integration-agent"
  runner       = "kubiya-hosted"
  description  = "Agent that uses external API"
  instructions = "You are an agent that integrates with external APIs using secure credentials."
  
  secrets = [kubiya_secret.api_key.name]
}
```

```hcl Database Credentials
variable "db_password" {
  type        = string
  sensitive   = true
  description = "Database password"
}

resource "kubiya_secret" "db_password" {
  name        = "production-db-password"
  value       = var.db_password
  description = "Production database password"
}

resource "kubiya_agent" "db_manager" {
  name         = "database-manager"
  runner       = "kubiya-hosted"
  description  = "Database management agent"
  instructions = "You are a database administrator. Use the production-db-password secret for database connections."
  
  secrets = [kubiya_secret.db_password.name]
  
  environment_variables = {
    DB_HOST     = "db.example.com"
    DB_PORT     = "5432"
    DB_NAME     = "production"
    DB_USER     = "admin"
  }
}
```

```hcl GitHub Token
variable "github_token" {
  type        = string
  sensitive   = true
  description = "GitHub Personal Access Token"
}

resource "kubiya_secret" "github_token" {
  name        = "github-pat"
  value       = var.github_token
  description = "GitHub Personal Access Token"
}

resource "kubiya_agent" "github_automation" {
  name         = "github-automation"
  runner       = "kubiya-hosted"
  description  = "GitHub automation agent"
  instructions = <<-EOT
    You are a GitHub automation agent. 
    Use the github-pat secret for API authentication.
    You can manage repositories, create pull requests, and handle issues.
  EOT
  
  secrets      = [kubiya_secret.github_token.name]
  integrations = ["github"]
}
```

</CodeGroup>

## Configuration Examples

<Tabs>
  <Tab title="Multiple Service Integration">
    Configure an agent with multiple secrets for various services:

    ```hcl
    resource "kubiya_secret" "slack_token" {
      name        = "slack-bot-token"
      value       = var.slack_bot_token
      description = "Slack bot token for notifications"
    }

    resource "kubiya_secret" "jira_token" {
      name        = "jira-api-token"
      value       = var.jira_api_token
      description = "Jira API token"
    }

    resource "kubiya_secret" "datadog_api_key" {
      name        = "datadog-api-key"
      value       = var.datadog_api_key
      description = "Datadog API key for monitoring"
    }

    resource "kubiya_agent" "integration_manager" {
      name         = "integration-manager"
      runner       = "kubiya-hosted"
      description  = "Multi-service integration manager"
      instructions = <<-EOT
        You manage integrations with multiple services:
        - Use slack-bot-token for Slack notifications
        - Use jira-api-token for Jira operations
        - Use datadog-api-key for monitoring tasks
      EOT
      
      secrets = [
        kubiya_secret.slack_token.name,
        kubiya_secret.jira_token.name,
        kubiya_secret.datadog_api_key.name
      ]
      
      integrations = ["slack", "jira", "datadog"]
    }
    ```
  </Tab>
  
  <Tab title="Environment-Specific Secrets">
    Create secrets for different environments using dynamic configuration:

    ```hcl
    variable "db_passwords" {
      type = map(string)
      sensitive = true
      description = "Database passwords per environment"
    }

    locals {
      environments = ["dev", "staging", "prod"]
    }

    resource "kubiya_secret" "env_db_passwords" {
      for_each = toset(local.environments)
      
      name        = "${each.value}-db-password"
      value       = var.db_passwords[each.value]
      description = "Database password for ${each.value} environment"
    }

    resource "kubiya_agent" "env_agents" {
      for_each = toset(local.environments)
      
      name         = "${each.value}-agent"
      runner       = "kubiya-hosted"
      description  = "Agent for ${each.value} environment"
      instructions = "You are an agent managing the ${each.value} environment."
      
      secrets = [kubiya_secret.env_db_passwords[each.value].name]
      
      environment_variables = {
        ENVIRONMENT = each.value
        DB_HOST     = "${each.value}-db.example.com"
      }
    }
    ```
  </Tab>
  
  <Tab title="AWS Credentials">
    Store AWS credentials securely:

    ```hcl
    variable "aws_access_key_id" {
      type        = string
      description = "AWS Access Key ID (non-sensitive)"
    }

    variable "aws_secret_access_key" {
      type        = string
      sensitive   = true
      description = "AWS Secret Access Key"
    }

    resource "kubiya_secret" "aws_secret_key" {
      name        = "aws-secret-access-key"
      value       = var.aws_secret_access_key
      description = "AWS Secret Access Key for automation"
    }

    resource "kubiya_agent" "aws_automation" {
      name         = "aws-automation"
      runner       = "kubiya-hosted"
      description  = "AWS automation agent"
      instructions = "You are an AWS automation agent. Use the AWS credentials securely for cloud operations."
      
      secrets = [kubiya_secret.aws_secret_key.name]
      
      environment_variables = {
        AWS_ACCESS_KEY_ID = var.aws_access_key_id
        AWS_REGION        = "us-west-2"
      }
    }
    ```
  </Tab>
</Tabs>

## Advanced Configurations

<Accordion title="SSH Private Key Storage">
  Store SSH private keys securely (base64 encoded):

  ```hcl
  resource "kubiya_secret" "ssh_key" {
    name        = "server-ssh-key"
    value       = base64encode(file("${path.module}/keys/id_rsa"))
    description = "SSH private key for server access (base64 encoded)"
  }

  resource "kubiya_agent" "server_admin" {
    name         = "server-administrator"
    runner       = "kubiya-hosted"
    description  = "Server administration agent"
    instructions = <<-EOT
      You are a server administrator with SSH access.
      The server-ssh-key secret contains the base64-encoded SSH private key.
      Decode it before use and handle it securely.
    EOT
    
    secrets = [kubiya_secret.ssh_key.name]
    
    environment_variables = {
      SSH_USER = "ubuntu"
      SSH_HOST = "server.example.com"
      SSH_PORT = "22"
    }
  }
  ```
</Accordion>

<Accordion title="JWT Signing Secret">
  Store JWT signing secrets for authentication:

  ```hcl
  variable "jwt_secret" {
    type        = string
    sensitive   = true
    description = "JWT signing secret"
  }

  resource "kubiya_secret" "jwt_secret" {
    name        = "jwt-signing-secret"
    value       = var.jwt_secret
    description = "Secret key for JWT token signing"
  }

  resource "kubiya_agent" "auth_agent" {
    name         = "authentication-agent"
    runner       = "kubiya-hosted"
    description  = "Authentication and authorization agent"
    instructions = <<-EOT
      You manage authentication and JWT tokens.
      Use the jwt-signing-secret for token operations.
      Never expose the secret value in logs or outputs.
    EOT
    
    secrets = [kubiya_secret.jwt_secret.name]
  }
  ```
</Accordion>

<Accordion title="Certificate Storage">
  Store certificates and other binary data securely:

  ```hcl
  resource "kubiya_secret" "tls_cert" {
    name        = "api-tls-certificate"
    value       = base64encode(file("${path.module}/certs/api.crt"))
    description = "TLS certificate for API server (base64 encoded)"
  }

  resource "kubiya_secret" "tls_key" {
    name        = "api-tls-private-key"
    value       = base64encode(file("${path.module}/certs/api.key"))
    description = "TLS private key for API server (base64 encoded)"
  }

  resource "kubiya_agent" "api_server" {
    name         = "api-server-manager"
    runner       = "kubiya-hosted"
    description  = "API server management agent"
    instructions = "You manage the API server with TLS certificates. Handle certificates securely."
    
    secrets = [
      kubiya_secret.tls_cert.name,
      kubiya_secret.tls_key.name
    ]
  }
  ```
</Accordion>

## Arguments Reference

### Required Arguments

<ParamField path="name" type="string" required>
  The name of the secret. Must be unique within your organization and follow naming conventions.
</ParamField>

<ParamField path="value" type="string" required>
  The secret value. This is write-only and cannot be read back after creation. Always use sensitive variables for this field.
</ParamField>

### Optional Arguments

<ParamField path="description" type="string">
  A description of the secret's purpose and usage. Helps with documentation and management.
</ParamField>

## Attributes Reference

In addition to all arguments above, the following attributes are exported:

<ParamField path="created_at" type="string">
  The timestamp when the secret was created.
</ParamField>

<ParamField path="created_by" type="string">
  The email of the user who created the secret.
</ParamField>

<Note>
The `value` attribute is write-only and will not be included in the state file or outputs for security reasons.
</Note>

## Import

Secrets can be imported using their name:

<CodeGroup>

```bash Import Command
terraform import kubiya_secret.example <secret-name>
```

```hcl Import Block
import {
  to = kubiya_secret.example
  id = "<secret-name>"
}
```

</CodeGroup>

<Warning>
The actual secret value cannot be read back after import for security reasons. You will need to update the value in your configuration to match the existing secret.
</Warning>

## Best Practices

<Card title="Security" icon="shield-halved">
  - Never hardcode sensitive values directly in Terraform files
  - Always use Terraform variables marked as `sensitive = true`
  - Ensure Terraform state is encrypted and stored securely
  - Implement regular secret rotation policies
</Card>

<Card title="Access Control" icon="user-lock">
  - Only grant secret access to agents that require it
  - Use descriptive names that indicate the secret's purpose and environment
  - Monitor secret access through Kubiya audit logs
  - Keep production and non-production secrets separate
</Card>

<Card title="Data Handling" icon="database">
  - Use base64 encoding for binary data like certificates or keys
  - Maintain secure backups of critical secrets outside of Terraform
  - Consider secret versioning for rotation strategies
  - Document secret dependencies clearly
</Card>

<Card title="Maintenance" icon="wrench">
  - Implement automated secret rotation where possible
  - Regular audit of secret usage and access patterns
  - Clean up unused secrets to reduce security surface
  - Version control secret configurations (but not values)
</Card>

## Security Considerations

<Warning>
**Important Security Notes:**
- Secret values are encrypted at rest in the Kubiya platform
- Secrets are only accessible to authorized agents during execution
- Always use Terraform's sensitive variable feature
- Never commit actual secret values to version control
</Warning>

<Note>
**State File Security:**
- Terraform state files may contain sensitive information
- Use encrypted remote state backends (S3 with KMS, Azure Storage with encryption)
- Restrict access to state files to authorized personnel only
- Consider using Terraform Cloud or similar services for enhanced security
</Note>

## Common Patterns

<Tabs>
  <Tab title="API Integration Pattern">
    Standard pattern for API integrations:

    ```hcl
    # variables.tf
    variable "service_api_key" {
      type        = string
      sensitive   = true
      description = "API key for external service"
    }

    # secrets.tf  
    resource "kubiya_secret" "service_api_key" {
      name        = "service-api-key"
      value       = var.service_api_key
      description = "API key for service integration"
    }

    # agents.tf
    resource "kubiya_agent" "service_agent" {
      name         = "service-integration"
      runner       = "kubiya-hosted"
      description  = "Service integration agent"
      instructions = "Use the service-api-key secret for API authentication."
      
      secrets = [kubiya_secret.service_api_key.name]
    }
    ```
  </Tab>
  
  <Tab title="Database Connection Pattern">
    Standard pattern for database connections:

    ```hcl
    # Store only the sensitive password as a secret
    resource "kubiya_secret" "db_password" {
      name        = "${var.environment}-db-password"
      value       = var.db_password
      description = "Database password for ${var.environment}"
    }

    resource "kubiya_agent" "db_agent" {
      name         = "${var.environment}-db-manager"
      runner       = "kubiya-hosted"
      description  = "Database management for ${var.environment}"
      instructions = "Connect to database using provided credentials."
      
      secrets = [kubiya_secret.db_password.name]
      
      environment_variables = {
        DB_HOST = var.db_host
        DB_PORT = var.db_port
        DB_NAME = var.db_name
        DB_USER = var.db_user
        # Password will be retrieved from secret
      }
    }
    ```
  </Tab>
  
  <Tab title="Multi-Environment Pattern">
    Pattern for managing secrets across environments:

    ```hcl
    variable "secrets_by_env" {
      type = map(map(string))
      sensitive = true
      description = "Secrets organized by environment"
      default = {}
    }

    locals {
      # Flatten the secrets structure
      secrets = flatten([
        for env_name, secrets in var.secrets_by_env : [
          for secret_name, secret_value in secrets : {
            key   = "${env_name}-${secret_name}"
            value = secret_value
            env   = env_name
            name  = secret_name
          }
        ]
      ])
    }

    resource "kubiya_secret" "env_secrets" {
      for_each = { for s in local.secrets : s.key => s }
      
      name        = each.value.key
      value       = each.value.value
      description = "${each.value.name} secret for ${each.value.env} environment"
    }
    ```
  </Tab>
</Tabs>

## Compatibility

<Note>
**Requirements:**
- Kubiya Terraform Provider version >= 1.0.0
- Terraform >= 1.0
- Secret values are write-only and cannot be read back after creation
- Secrets must exist before agents can reference them
</Note>

## Troubleshooting

<Accordion title="Secret Access Issues">
  - Verify the secret name exactly matches what's configured in the agent
  - Check that the agent has the secret listed in its secrets array
  - Ensure the secret exists before the agent tries to use it
  - Review agent logs for secret-related error messages
</Accordion>

<Accordion title="Import and Update Issues">
  - Remember that secret values cannot be read back after creation
  - When importing, you must specify the correct value in your configuration
  - Changes to secret values will trigger recreation of the secret
  - Test secret updates in non-production environments first
</Accordion>

<Accordion title="State File Security">
  - Ensure your Terraform state backend is properly encrypted
  - Use remote state with access controls
  - Regularly audit who has access to Terraform state
  - Consider using Terraform Cloud for enhanced state security
</Accordion>